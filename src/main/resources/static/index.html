<!DOCTYPE html>
<!--suppress HtmlFormInputWithoutLabel -->
<html lang="">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <title>Title</title>
</head>
<body>

<h2>Scheduler</h2>

<!--TRANSACTIONS LIST-->
<table class="myclass" id="orders">
    <thead>
    <tr>
        <th>Description</th>
        <th>Execution Date</th>
        <th>Amount</th>
        <th></th>
        <th></th>
        <th></th>
        <th style="font-size:0;">ID</th>
    </tr>
    </thead>
    <tbody>
    <tr style="background: #c7a800;">
        <td colspan="6"></td>
    </tr>
    </tbody>
</table>

<!--NEW SINGLE ORDER-->
<div style="overflow: hidden">
    <div style="padding: 10px"></div>                                                   <!-- SPACING -->
    <table class="myclass">
        <tr>
            <td style="padding: 5px"><h4>Enter new Single Order</h4></td>
            <td style="cursor: pointer; padding: 5px" id="clickme1"><img style="vertical-align:middle;" width="15px"
                                                                         alt="Plus" src="images/plus.svg"></td>
        </tr>
    </table>                                                          <!-- TITLE -->
    <div id="id12345" style="display:none; float: left; padding-bottom: 3px;">
        <table class="myclass">
            <thead>
            <tr>
                <th>Description</th>
                <th>Wire Transfer</th>
                <th>Day</th>
                <th>Month</th>
                <th>Year</th>
                <th>Amount</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr id="singleordernew">
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <input onkeyup="forgivedesc(this)" style="border: 0; padding-top: 3.2px; padding-bottom: 3.2px"
                               size="40" type="text" name="descr">
                    </div>
                </td>   <!-- Desc -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800;">
                        <select onchange="forgivewt(this)" name="wt" style="padding: 1.8px">
                            <option value="$">--Please Select--</option>
                            <option style="color : black" value="true">Yes</option>
                            <option style="color : black" value="false">No</option>
                        </select>
                    </div>
                </td>   <!-- WT -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <select onchange="forgiveday(this)" style="padding: 1.8px" name="day">
                            <option value="$">--Please Select--</option>
                        </select>
                    </div>
                </td>   <!-- Day -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <select onchange="sssetdays()" name="month" style="padding: 1.8px">
                            <option value="$">--Please Select--</option>
                            <option style="color : black" value="1">January</option>
                            <option style="color : black" value="2">February</option>
                            <option style="color : black" value="3">March</option>
                            <option style="color : black" value="4">April</option>
                            <option style="color : black" value="5">May</option>
                            <option style="color : black" value="6">June</option>
                            <option style="color : black" value="7">July</option>
                            <option style="color : black" value="8">August</option>
                            <option style="color : black" value="9">September</option>
                            <option style="color : black" value="10">October</option>
                            <option style="color : black" value="11">November</option>
                            <option style="color : black" value="12">December</option>
                        </select>
                    </div>
                </td>   <!-- Month -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <input oninput="checkyears(this)" onkeyup="ssetdays()"
                               style="border: 0; padding-top: 3.2px; padding-bottom: 3.2px"
                               type="text" name="year" size="3">
                    </div>
                </td>   <!-- Year -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <input oninput="checksamount(this)"
                               style="border: 0px; padding-top: 3.2px; padding-bottom: 3.2px"
                               type="text" name="amount" size="10">
                    </div>
                </td>   <!-- Amount -->
                <td>
                    <img onclick="addnews()" style="cursor: pointer; vertical-align:middle;" width="20px" alt="Plus"
                         src="images/plus.svg">
                </td>                                                   <!-- Button add -->
            </tr>
            </tbody>
        </table>
    </div>       <!-- ACTUAL CONTENT -->
    <hr style="border: 2px solid #c7a800; width: 61% ; float: left"/>                   <!-- LINE UNDERNEATH -->
</div>

<!-- SPACING -->
<div style="margin: 40px"></div>

<!--NEW REPEATED ORDER-->
<div style="overflow: hidden">
    <table class="myclass">
        <tr>
            <td style="padding: 5px"><h4>Enter new Repeated Order</h4></td>
            <td style="cursor: pointer; padding: 5px" id="clickme2"><img style="vertical-align:middle;" width="15px"
                                                                         alt="No" src="images/plus.svg"></td>
        </tr>
    </table>
    <div id="id12346" style="display:none; float: left; padding-bottom: 3px;">
        <table class="myclass">
            <thead>
            <tr>
                <th></th>
                <th></th>
                <th style="border-bottom: 2px solid #c7a800; text-align: center" colspan="2">Frequency</th>
                <th style="border-bottom: 2px solid #c7a800; text-align: center" colspan="3">Initial Date</th>
                <th style="border-bottom: 2px solid #c7a800; text-align: center" colspan="3">Final Date</th>
                <th style="font-size:0;">Empty space</th>
            </tr>
            <tr>
                <th>Description</th>
                <th>Wire Transfer</th>
                <th></th>
                <th></th>
                <th>Day</th>
                <th>Month</th>
                <th>Year</th>
                <th>Day</th>
                <th>Month</th>
                <th>Year</th>
                <th>Amount</th>
                <th></th>
                <th style="font-size:0;">Empty space</th>
            </tr>
            </thead>
            <tbody>
            <tr id="repeatedordernew">
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <input onkeyup="forgivedesc(this)" style="border: 0; padding-top: 3.2px; padding-bottom: 3.2px"
                               size="40" type="text" name="descr">
                    </div>
                </td>   <!-- Desc -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800;">
                        <select onchange="forgivewt(this)" name="wt" style="padding: 1.8px">
                            <option value="$">--Please Select--</option>
                            <option style="color : black" value="true">Yes</option>
                            <option style="color : black" value="false">No</option>
                        </select>
                    </div>
                </td>   <!-- WT -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <input style="border: 0; padding-top: 3.2px; padding-bottom: 3.2px" name="f1" size="3" type=text
                               oninput="wrapperf1(this)">
                    </div>
                </td>   <!-- F1 -->
                <td style="padding-left: 8px; padding-right: 8px">
                    <div style="border: 2px solid #c7a800;">
                        <select onchange="forgivef2(this)" style="padding: 1.8px" name="f2">
                            <option value="$">--Please Select--</option>
                            <option style="color : black" value="Days">Days</option>
                            <option style="color : black" value="Months">Months</option>
                            <option style="color : black" value="Years">Years</option>
                        </select>
                    </div>
                </td>     <!-- F2 -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <select onchange="forgiveday(this)" style="padding: 1.8px" name="day1">
                            <option value="$">--Please Select--</option>
                        </select>
                    </div>
                </td>   <!-- Day -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <select onchange="wrappermonth(this)" name="month1" style="padding: 1.8px">
                            <option value="$">--Please Select--</option>
                            <option style="color : black" value="1">January</option>
                            <option style="color : black" value="2">February</option>
                            <option style="color : black" value="3">March</option>
                            <option style="color : black" value="4">April</option>
                            <option style="color : black" value="5">May</option>
                            <option style="color : black" value="6">June</option>
                            <option style="color : black" value="7">July</option>
                            <option style="color : black" value="8">August</option>
                            <option style="color : black" value="9">September</option>
                            <option style="color : black" value="10">October</option>
                            <option style="color : black" value="11">November</option>
                            <option style="color : black" value="12">December</option>
                        </select>
                    </div>
                </td>   <!-- Month -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <input oninput="checkyears(this)" onkeyup="rsetdays1()"
                               style="border: 0; padding-top: 3.2px; padding-bottom: 3.2px"
                               type="text" name="year1" size="3">
                    </div>
                </td>   <!-- Year -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <select onchange="forgiveday(this)" style="padding: 1.8px" name="day2">
                            <option value="$">--Please Select--</option>
                        </select>
                    </div>
                </td>   <!-- Day -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <select onchange="rsetdays2()" name="month2" style="padding: 1.8px">
                            <option value="$">--Please Select--</option>
                            <option style="color : black" value="1">January</option>
                            <option style="color : black" value="2">February</option>
                            <option style="color : black" value="3">March</option>
                            <option style="color : black" value="4">April</option>
                            <option style="color : black" value="5">May</option>
                            <option style="color : black" value="6">June</option>
                            <option style="color : black" value="7">July</option>
                            <option style="color : black" value="8">August</option>
                            <option style="color : black" value="9">September</option>
                            <option style="color : black" value="10">October</option>
                            <option style="color : black" value="11">November</option>
                            <option style="color : black" value="12">December</option>
                        </select>
                    </div>
                </td>   <!-- Month -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <input oninput="checkyears(this)" onkeyup="rsetdays2()"
                               style="border: 0; padding-top: 3.2px; padding-bottom: 3.2px"
                               type="text" name="year2" size="3">
                    </div>
                </td>   <!-- Year -->
                <td style="padding-left: 10px; padding-right: 10px">
                    <div style="border: 2px solid #c7a800; ">
                        <input oninput="checksamount(this)"
                               style="border: 0px; padding-top: 3.2px; padding-bottom: 3.2px"
                               type="text" name="amount" size="10">
                    </div>
                </td>   <!-- Amount -->
                <td>
                    <img onclick="addnewr()" style="cursor: pointer; vertical-align:middle;" width="20px" alt="Plus"
                         src="images/plus.svg">
                </td>                                                   <!-- Button add -->
                <td></td>
            </tr>
            </tbody>
        </table>
    </div>
    <hr style="border: 2px solid #c7a800; width: 95% ; float: left"/>
</div>

<!-- SPACING -->
<div style="padding: 20px"></div>


<a onclick="haltprocessor()">Stop</a>
<!-- HERE BELOW IT IS ALWAYS UPDATED THE FULL SCHEDULE-->


</body>

<!-- POPULATE(S/R) -->
<script>
    function populate1() {
        $.post("/populate1", function (returnedData) {

            if (returnedData === "")
                return;

            let el = $("#orders tbody");
            el.empty();
            el.append("        <tr style=\"background: #c7a800;\">\n" +
                "            <td colspan=\"6\"></td>\n" +
                "        </tr>");

            returnedData = returnedData.trim()
            var lines = returnedData.split("\n")

            for (var i = 0; i < lines.length; i++) {
                data = lines[i].split(";")
                el.append("        <tr name=" + data[0] + ">\n" +
                    "            <td>" + data[1] + "</td>\n" +
                    "            <td><div class=\"animate\">Loading</div></td>\n" +
                    "            <td>" + data[6] + "</td>\n" +
                    "            <td onclick='duplicate(" + data[0] + ")' style=\"cursor: pointer; padding: 5px\"><img style=\"vertical-align:middle;\" width=\"15px\"\n" +
                    "                                                           alt=\"No\" src=\"images/plus.svg\"></td>\n" +
                    "            <td style=\"cursor: pointer; padding: 5px\"><img style=\"vertical-align:middle;\" width=\"15px\"\n" +
                    "                                                           alt=\"No\" src=\"images/pencil.svg\"></td>\n" +
                    "            <td onclick='_delete(" + data[0] + ")' style=\"cursor: pointer; padding: 5px\"><img style=\"vertical-align:middle;\" width=\"15px\"\n" +
                    "                                                           alt=\"No\" src=\"images/bin.svg\"></td>\n" +
                    "            <td style=\"font-size:0;\">" + "" + "</td>\n" +
                    "        </tr>")
            }

            var i = 0
            el.find("tr").each(function () {
                var ell = $(this).children();
                if (ell.length > 1) {
                    $.post("/schedule", {data: lines[i]}, function (returnedData) {
                        ell[1].removeChild(ell[1].firstChild)
                        ell[1].append(returnedData)
                    })
                    i++;
                }
            });


        }).fail(function () {
            console.log("error")
        })
    }
</script>

<!-- INITIALIZER SCRIPT-->
<script>

    populate1();

</script>

<!-- SLIDESHOW SCRIPTS-->
<script>
    $("#clickme1").click(function () {
        if (!$("#id12345").is(':visible')) {
            $("#id12345").slideDown(1500, function () {
                $("#clickme1").children().attr("src", "images/minus.png")
            });
        } else {
            $("#id12345").slideUp(1500, function () {
                $("#clickme1").children().attr("src", "images/plus.svg")
            });
        }
    });

    $("#clickme2").click(function () {
        if (!$("#id12346").is(':visible')) {
            $("#id12346").slideDown(1500, function () {
                $("#clickme2").children().attr("src", "images/minus.png")
            });
        } else {
            $("#id12346").slideUp(1500, function () {
                $("#clickme2").children().attr("src", "images/plus.svg")
            });
        }
    });
</script>


<!-- FUNCTIONS -->
<script>

    function prev(curr, caret) {
        return [curr.slice(0, caret - 1) + curr.slice(caret), caret - 1, caret - 1];
    }

    const forgivedesc = function (k) {
        if (k.value !== "")
            k.parentElement.style.border = "2px solid #c7a800";

        if (k.value.includes(";"))
            k.style.removeProperty("color");
    }

    const forgivewt = function (k) {
        if (!k.options[k.selectedIndex].value.includes("$"))
            k.style.removeProperty("color");
    }

    function wrapperf1(k) {
        if (!/^[1-9][0-9]*$/.test(k.value)) {
            [k.value, k.selectionEnd, k.selectionStart] = prev(k.value, k.selectionStart)
        }

        if (k.value !== "")
            k.parentElement.style.border = "2px solid #c7a800";
    }

    const forgivef2 = function (k) {
        if (!k.options[k.selectedIndex].value.includes("$"))
            k.style.removeProperty("color");
    }

    const forgiveday = function (k) {
        if (!k.options[k.selectedIndex].value.includes("$"))
            k.style.removeProperty("color");
    }

    function wrappermonth(k) {
        if (!k.options[k.selectedIndex].value.includes("$"))
            k.style.removeProperty("color");

        rsetdays(k);

    }

    var checksamount = function (el) {
        let caret = el.selectionStart;
        let post;
        let pre;
        let pos;
        let str = el.value;
        let matches = 0;

        matches = str.match(/[^\d.-]/g);
        caret -= (matches === null ? 0 : matches.length);
        str = str.replace(/[^\d.-]/g, '');

        matches = str.match(/-/g);
        caret -= (matches === null ? 0 : matches.length);
        if (str.indexOf("-") === 0) {
            str = str.replace(/-/g, '');
            str = "-" + str;
            caret++;
        } else {
            str = str.replace(/-/g, '');
        }

        matches = str.match(/\./g);
        caret -= (matches === null ? 0 : matches.length);
        if (str.includes(".")) {
            pos = str.lastIndexOf(".");
            pre = str.slice(0, pos);
            post = str.slice(pos);
            pre = pre.replace(/\./g, '');
            str = pre + post;
            caret++;
        }

        pos = str.indexOf(".");

        if (pos > -1) {
            pre = str.slice(0, pos);
            post = str.slice(pos, pos + 3);
            post = post.slice(0, 3);
            str = pre + post;
        }

        if (str[0] === "0") {
            matches = str.match(/^0+/);
            caret -= (matches === null ? 0 : matches.length);
            str = str.replace(/^0+/, "");
            str = "0" + str;
            caret++;
        } else {
            matches = str.match(/^0+/);
            caret -= (matches === null ? 0 : matches.length);
            str = str.replace(/^0+/, "");
        }

        el.value = str;
        el.selectionEnd = el.selectionStart = (caret > 0 ? caret : 0);

        el = $("#singleordernew");
        if (el.find("[name = amount]").val() !== "")
            el.find("[name = amount]").parent().css("border", "2px solid #c7a800");

        if (el.find("[name = amount]").val() !== "-")
            el.find("[name = amount]").css("color", "");

        if (!isNaN(el.find("[name = amount]").val()))
            el.find("[name = amount]").css("color", "");

    }

    const checkyears = function (el) {
        let caret = el.selectionStart;
        let str = el.value;
        let matches = 0;

        matches = str.match(/[^\d-]/g);
        caret -= (matches === null ? 0 : matches.length);
        str = str.replace(/[^\d-]/g, '');

        matches = str.match(/-/g);
        caret -= (matches === null ? 0 : matches.length);
        if (str.indexOf("-") === 0) {
            str = str.replace(/-/g, '');
            str = "-" + str;
            caret++;
        } else {
            str = str.replace(/-/g, '');
        }

        if (str !== "0") {
            if (str[0] === "0" && str[1] === "0") {
                matches = str.match(/^0+/);
                caret -= (matches === null ? 0 : matches.length);
                str = str.replace(/^0+/, "");
                str = "0";
                caret++;
            } else {
                matches = str.match(/^0+/);
                caret -= (matches === null ? 0 : matches.length);
                str = str.replace(/^0+/, "");
            }
        }

        el.value = str;
        el.selectionEnd = el.selectionStart = caret;
    };

    function ssetdays() {

        checkyears($("#singleordernew").find("[name = year]")[0])

        var el = $("#singleordernew");

        var yy = undefined;
        if (el.find("[name = year]").val() !== "" && el.find("[name = year]").val() !== "-") {
            yy = el.find("[name = year]").val();
        }

        var res = new Date(yy, (el.find("[name = month] :selected").val()), 0);
        res = res.getDate();

        el.find("[name = day]").empty();
        el.find("[name = day]").append("<option value=\"$\">--Please Select--</option>");
        for (var i = 1; i < res; i++) {
            el.find("[name = day]").append("<option style=\"color : black\" value=\"" + i + "\">" + i + "</option>");
        }
        if (res > 0)
            el.find("[name = day]").append("<option style=\"color : black\" value=\"" + i + "\">End of month</option>");

        if (!el.find("[name = month] :selected").val().includes("$"))
            el.find("[name = month]").css("color", "");

        if (el.find("[name = year]").val() !== "")
            el.find("[name = year]").parent().css("border", "2px solid #c7a800");

        if (el.find("[name = year]").val() !== "-")
            el.find("[name = year]").css("color", "");
    }

    function rsetdays1() {

        checkyears($("#repeatedordernew").find("[name = year1]")[0])

        var el = $("#repeatedordernew");

        var yy = undefined;
        if (el.find("[name = year1]").val() !== "" && el.find("[name = year1]").val() !== "-") {
            yy = el.find("[name = year1]").val();
        }

        var res = new Date(yy, (el.find("[name = month1] :selected").val()), 0);
        res = res.getDate();

        el.find("[name = day1]").empty();
        el.find("[name = day1]").append("<option value=\"$\">--Please Select--</option>");
        for (var i = 1; i < res; i++) {
            el.find("[name = day1]").append("<option style=\"color : black\" value=\"" + i + "\">" + i + "</option>");
        }
        if (res > 0)
            el.find("[name = day1]").append("<option style=\"color : black\" value=\"" + i + "\">End of month</option>");

        if (!el.find("[name = month1] :selected").val().includes("$"))
            el.find("[name = month1]").css("color", "");

        if (el.find("[name = year1]").val() !== "")
            el.find("[name = year1]").parent().css("border", "2px solid #c7a800");

        if (el.find("[name = year1]").val() !== "-")
            el.find("[name = year1]").css("color", "");
    }

    function rsetdays2() {

        checkyears($("#repeatedordernew").find("[name = year2]")[0])

        var el = $("#repeatedordernew");

        var yy = undefined;
        if (el.find("[name = year2]").val() !== "" && el.find("[name = year2]").val() !== "-") {
            yy = el.find("[name = year2]").val();
        }

        var res = new Date(yy, (el.find("[name = month2] :selected").val()), 0);
        res = res.getDate();

        el.find("[name = day2]").empty();
        el.find("[name = day2]").append("<option value=\"$\">--Please Select--</option>");
        for (var i = 1; i < res; i++) {
            el.find("[name = day2]").append("<option style=\"color : black\" value=\"" + i + "\">" + i + "</option>");
        }
        if (res > 0)
            el.find("[name = day2]").append("<option style=\"color : black\" value=\"" + i + "\">End of month</option>");

        if (!el.find("[name = month2] :selected").val().includes("$"))
            el.find("[name = month2]").css("color", "");

        if (el.find("[name = year2]").val() !== "")
            el.find("[name = year2]").parent().css("border", "2px solid #c7a800");

        if (el.find("[name = year2]").val() !== "-")
            el.find("[name = year2]").css("color", "");
    }
</script>

<!-- CALLS TO SERVER -->
<script>
    function _delete(_id) {
        $.post("/delete", {data: _id}, function (returnedData) {
            $("#orders tbody").find("[name = " + _id + "]").remove();
            console.log(returnedData)
        }).fail(function () {
            console.log("error")
        })
    }

    function duplicate(_id) {
        $.post("/duplicate", {data: _id}, function (returnedData) {
            populate1();
            console.log(returnedData)
        }).fail(function () {
            console.log("error")
        })
    }

    function addnews() {
        var line = ""
        var el = $("#singleordernew");
        var flag = false;

        //CHECKS
        if (el.find("[name = descr]").val() === "") {
            el.find("[name = descr]").parent().css("border", "2px solid red");
            flag = true;
        }

        if (el.find("[name = descr]").val().includes(";")) {
            el.find("[name = descr]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = wt] :selected").val().includes("$")) {
            el.find("[name = wt]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = day] :selected").val().includes("$")) {
            el.find("[name = day]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = month] :selected").val().includes("$")) {
            el.find("[name = month]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = year]").val() === "") {
            el.find("[name = year]").parent().css("border", "2px solid red");
            flag = true;
        }

        if (el.find("[name = year]").val() === "-") {
            el.find("[name = year]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = amount]").val() === "") {
            el.find("[name = amount]").parent().css("border", "2px solid red");
            flag = true;
        }

        if (el.find("[name = amount]").val() === "-") {
            el.find("[name = amount]").css("color", "red");
            flag = true;
        }

        if (isNaN(el.find("[name = amount]").val())) {
            el.find("[name = amount]").css("color", "red");
            flag = true;
        }

        if (flag)
            return;

        el.find("[name = amount]").val(parseFloat(el.find("[name = amount]").val()).toFixed(2));

        //PREPARE TO SEND
        line += el.find("[name = descr]").val() + '; '
        line += el.find("[name = wt] :selected").val() + '; '
        line += el.find("[name = year]").val() + '; '
        line += el.find("[name = month] :selected").val() + '; '
        line += el.find("[name = day] :selected").val() + '; '
        line += parseFloat(el.find("[name = amount]").val()).toFixed(2) + ';'

        $.post("/addnews", {data: line}, function (returnedData) {
            el.find("[name = descr]").val("")
            el.find("[name = wt]").val("$")
            el.find("[name = year]").val("")
            el.find("[name = month]").val("$")
            el.find("[name = day]").empty();
            el.find("[name = day]").append("<option value=\"$\">--Please Select--</option>");
            el.find("[name = amount]").val("")

            populate1();

            console.log(returnedData)
        }).fail(function () {
            console.log("error")
        })
    }

    function addnewr() {
        var line = ""
        var el = $("#repeatedordernew");
        var flag = false;

        //CHECKS
        if (el.find("[name = descr]").val() === "") {
            el.find("[name = descr]").parent().css("border", "2px solid red");
            flag = true;
        }

        if (el.find("[name = descr]").val().includes(";")) {
            el.find("[name = descr]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = wt] :selected").val().includes("$")) {
            el.find("[name = wt]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = f1] ").val() === "") {
            el.find("[name = f1]").parent().css("border", "2px solid red");
            flag = true;
        }

        if (el.find("[name = f2] :selected").val().includes("$")) {
            el.find("[name = f2]").css("color", "red");
            flag = true;
        }


        if (el.find("[name = day1] :selected").val().includes("$")) {
            el.find("[name = day1]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = month1] :selected").val().includes("$")) {
            el.find("[name = month1]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = year1]").val() === "") {
            el.find("[name = year1]").parent().css("border", "2px solid red");
            flag = true;
        }

        if (el.find("[name = year1]").val() === "-") {
            el.find("[name = year1]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = day2] :selected").val().includes("$")) {
            el.find("[name = day2]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = month2] :selected").val().includes("$")) {
            el.find("[name = month2]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = year2]").val() === "") {
            el.find("[name = year2]").parent().css("border", "2px solid red");
            flag = true;
        }

        if (el.find("[name = year2]").val() === "-") {
            el.find("[name = year2]").css("color", "red");
            flag = true;
        }

        if (el.find("[name = amount]").val() === "") {
            el.find("[name = amount]").parent().css("border", "2px solid red");
            flag = true;
        }

        if (el.find("[name = amount]").val() === "-") {
            el.find("[name = amount]").css("color", "red");
            flag = true;
        }

        if (isNaN(el.find("[name = amount]").val())) {
            el.find("[name = amount]").css("color", "red");
            flag = true;
        }

        if (flag)
            return;

        el.find("[name = amount]").val(parseFloat(el.find("[name = amount]").val()).toFixed(2));

        //PREPARE TO SEND
        line += el.find("[name = descr]").val() + '; '
        line += el.find("[name = wt] :selected").val() + '; '
        line += el.find("[name = year]").val() + '; '
        line += el.find("[name = month] :selected").val() + '; '
        line += el.find("[name = day] :selected").val() + '; '
        line += parseFloat(el.find("[name = amount]").val()).toFixed(2) + ';'

        $.post("/addnews", {data: line}, function (returnedData) {
            el.find("[name = descr]").val("")
            el.find("[name = wt]").val("$")
            el.find("[name = year]").val("")
            el.find("[name = month]").val("$")
            el.find("[name = day]").empty();
            el.find("[name = day]").append("<option value=\"$\">--Please Select--</option>");
            el.find("[name = amount]").val("")

            populate1();

            console.log(returnedData)
        }).fail(function () {
            console.log("error")
        })
    }

    function haltprocessor() {
        $.post("/haltprocessor")
    }
</script>


</html>

